<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Fudi</title>

<!-- Sets initial viewport load and disables zooming  -->
<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

<!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="mobile-web-app-capable" content="yes">

<!-- Include the compiled Ratchet CSS -->
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/font-awesome.min.css" rel="stylesheet">
<link href="css/jquery.bxslider.css" rel="stylesheet">
<link href="css/styles.css" rel="stylesheet">
<style>
html, body {
	height: 100%;
}
 @-moz-keyframes pulsate {
 from {
 -moz-transform: scale(0.25);
 opacity: 1.0;
}
 95% {
 -moz-transform: scale(1.3);
 opacity: 0;
}
to {
	-moz-transform: scale(0.3);
	opacity: 0;
}
}
 @-webkit-keyframes pulsate {
 from {
 -webkit-transform: scale(0.25);
 opacity: 1.0;
}
 95% {
 -webkit-transform: scale(1.3);
 opacity: 0;
}
to {
	-webkit-transform: scale(0.3);
	opacity: 0;
}
}
/* get the container that's just outside the marker image, 
		which just happens to have our Marker title in it */
#map div.gmnoprint[title="I might be here"] {
	-moz-animation: pulsate 1.5s ease-in-out infinite;
	-webkit-animation: pulsate 1.5s ease-in-out infinite;
	border: 1pt solid #fff;
	/* make a circle */
	-moz-border-radius: 51px;
	-webkit-border-radius: 51px;
	border-radius: 51px;
	/* multiply the shadows, inside and outside the circle */
	-moz-box-shadow: inset 0 0 5px #06f, inset 0 0 5px #06f, inset 0 0 5px #06f, 0 0 5px #06f, 0 0 5px #06f, 0 0 5px #06f;
	-webkit-box-shadow: inset 0 0 5px #06f, inset 0 0 5px #06f, inset 0 0 5px #06f, 0 0 5px #06f, 0 0 5px #06f, 0 0 5px #06f;
	box-shadow: inset 0 0 5px #06f, inset 0 0 5px #06f, inset 0 0 5px #06f, 0 0 5px #06f, 0 0 5px #06f, 0 0 5px #06f;
	/* set the ring's new dimension and re-center it */
	height: 51px!important;
	margin: -18px 0 0 -18px;
	width: 51px!important;
}
/* hide the superfluous marker image since it would expand and shrink with its containing element */
/*	#map div[style*="987654"][title] img {*/
#map div.gmnoprint[title="I might be here"] img {
	display: none;
}
	/* compensate for iPhone and Android devices with high DPI, add iPad media query */
	@media only screen and (-webkit-min-device-pixel-ratio: 1.5), only screen and (device-width: 768px) {
#map div.gmnoprint[title="I might be here"] {
	margin: -10px 0 0 -10px;
}
}
</style>
</head>
<body id="wrapper">
<div id="sidebar-wrapper">
	<nav id="nav">
		<ul class="sidebar-nav nav" id="navRight">
			<li class="L0 menu-heading"><i class="icon-user"></i><strong><a href="#" data-bind="text: lang.Foodie"></a></strong></li>
			<li class="L2"><i class="icon-pointer-advice"></i><a class="sub" href="map.html" data-bind="text: lang.mnuChefs"></a><li></li>
			<li class="L2"><i class="icon-user"></i><a class="sub" href="user-profile.html" data-bind="text: lang.MyProfile"></a></li>
			<li class="L2"><i class="icon-credit-cards"></i><a class="sub" href="payment-options.html" data-bind="text: lang.PO"></a></li>
			<li class="L2"><i class="icon-tray"></i><a class="sub" href="reservations.html" data-bind="text: lang.MyOrders"></a></li>
			<li class="L2"><i class="icon-mail"></i><a class="sub" href="notifications.html" data-bind="text: lang.Notifications"></a></li>
			<li class="L0 menu-heading"><i class="icon-chef"></i><strong><a data-bind="text: lang.CHEF" href="#"></a></strong></li>
			<li class="L2 noChef"><i class="icon-chef"></i><a class="sub" data-bind="text: lang.BecomeaChef" href="chef-profile-edit.html"></a></li>
			<li class="L2 isChef pChef"><i class="icon-chef"></i><a class="sub" data-bind="text: lang.ChefProfile" href="chef-profile-edit.html"></a></li>
			<li class="L2 isChef"><i class="icon-food"></i><a class="sub" data-bind="text: lang.ManageDishes" href="chef-dishes.html"></a></li>
			<li class="L2 isChef"><i class="icon-clock"></i><a class="sub" data-bind="text: lang.Schedule" href="chef-calendar-set.html"></a></li>
			<li class="L2 isChef"><i class="icon-calendar"></i><a class="sub" data-bind="text: lang.DeliverySchedule" href="delivery-schedule.html"></a></li>
			<li class="L2 isChef"><i class="icon-calendar-1"></i><a class="sub" data-bind="text: lang.PSmenu" href="ps-schedule.html"></a></li>
			<li class="L2 isChef"><i class="icon-reserve"></i><a class="sub" data-bind="text: lang.ChefReservations" href="chef-reservations.html"></a></li>
			<li class="L2 isChef"><i class="icon-withdraw"></i><a class="sub" data-bind="text: lang.WithdMon" href="withdraw-money-chef.html"></a></li>
			<li class="L1"><i class="icon-gear"></i><a href="settings.html" data-bind="text: lang.Settings"></a></li>
			<li class="L1"><i class="icon-about"></i><a href="about.html" data-bind="text: lang.AboutFudi"></a></li>
			<li class="L1"><i class="icon-logout"></i><a href="register.html?do=logout" data-bind="text: lang.Logout"></a></li>
		</ul>
	</nav>
</div>


<div class="content" style="height:100%; padding-bottom:90px;">
	<h1 style="display:inline-block; width:100%; margin-left:0px; padding-left:20px;" id="menu-button">
		<button id="btnListView" style="margin:18px 20px 0 0; padding:4px 6px; font-size:14px; display:none" class="pull-right btn btn-primary">List View</button>
		<button id="btnMapView" style="margin:18px 20px 0 0; padding:4px 6px; font-size:14px; " class="pull-right btn btn-primary">Map View</button>
		<a id="menu-toggle" href="#" class="btn-menu toggle"> <i class="fa fa-bars"></i> </a>
		<p class="pageTitle"><span data-bind="text: lang.SearchChefs"></span></p>
	</h1>
	
	
	
	
	
	<div id="MapView" style="height:100%; display:none">
		<div id="map" style="height:100%;"></div>
	</div>
	
	
	<div id="ListView">
		<div id="chef-listing-page" class="content"> 
			<!-- Chef Listing --> 
			<div class="chef-listing hidden">
				<div class="container">
					<div class="row">
						<div class="col-xs-12">
							<div class="chef-carousel-container">
								<ul class="chef-carousel">
								</ul>
							</div>
						</div>
						<div class="col-xs-12">
							<div class="chef-text">
								<h1 class="chef-title">Johnson Williams</h1>
								<p class="chef-city">California</p><button class="btn btn-primary btn-sm btnMoreInfo pull-right ">More Info</button>
								<p class="chef-distance"></p>
								
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Chef Listing --> 
		</div>
	</div>
	
	
	
	
	
</div>




<div id="bottom-bar">
	<div class="container">
		
		<div class="row row1">
			<span id="footerLinksNormal">
				<div class="col-xs-3 no-padding"> <a class="tab-item active" href="map.html"> <i class="icon-map"></i> </a> </div>
				<div class="col-xs-3 no-padding"> <a class="tab-item" href="reservations.html"> <i class="icon-bell-covering-hot-dish"></i> </a> </div>
				<div class="col-xs-3 no-padding"> <a class="tab-item " href="user-profile.html"> <i class="icon-user-1"></i> </a> </div>
				<div class="col-xs-3 no-padding"> <a class="tab-item " id="anoti" href="notifications.html"> <i class="icon-alarm"></i> </a>	</div>
			</span>
			<span id="footerLinksNoLogin">
				<div class="col-xs-6 no-padding"> <a class="tab-item " href="register.html"> <i class="icon-user-1"></i> </a> </div>
				<div class="col-xs-6 no-padding"> <a class="tab-item active" href="map.html"> <i class="icon-map"></i> </a> </div>
			</span>
		</div>
		
		<div class="row row2" style="display:none">
			<div class="col-xs-4 no-padding"> <a class="tab-item active dine" href="#"> Dine In </a> </div>
			<div class="col-xs-4 no-padding"> <a class="tab-item active delivery" href="#"> Delivery </a> </div>
			<div class="col-xs-4 no-padding"> <a class="tab-item active ps" href="#"> Personal Chef </a> </div>
		</div>
		
	</div>
</div>

<!--<div class="modal fade" id="infoWin" tabindex="-1" aria-labelledby="myModal" role="dialog" aria-hidden="true" style="padding-top:15%; overflow-y:visible;">
	<div class="modal-dialog modal-md">
		<div class="modal-content"><button type="button" class="Bclose" data-dismiss="modal" aria-label="Close"><i class="fa fa-times-circle"></i></button>
			<div class="modal-body">
				<div class="col-xs-6 no-padding">
					<div class="side-contents">
						
					</div>
				</div>
				<div class="col-xs-6 no-padding">
					<div class="model-image"><img src="http://mobileapi.foodiesys.com/foodie-mssql/pics/56b51db83a9a9.jpg" alt="capture" class="img-responsive"></div>
				</div>
			</div>
			<div class="clearfix"></div>
		</div>
	</div>
</div>-->

<div class="modal fade" id="infoWin" tabindex="-1" aria-labelledby="myModal" role="dialog" aria-hidden="true" style="padding-top:15%; overflow-y:visible; ">
	<div class="modal-dialog modal-infowin">
		<div class="modal-content"><button type="button" class="Bclose" data-dismiss="modal" aria-label="Close"><i class="fa fa-times-circle"></i></button>
			<div class="modal-body">
				<div class="no-padding">
					<div class="model-image text-center"><img src="http://mobileapi.foodiesys.com/foodie-mssql/pics/56b51db83a9a9.jpg" alt="capture" class="img-responsive"></div>
					<div class="side-contents">
						
						
						
					</div>
				</div>
				
			</div>
			<div class="clearfix"></div>
		</div>
	</div>
</div>



<script src="cordova.js"></script> 
<script src="js/jquery-1.11.3.min.js"></script> 
<script src="js/bootstrap.min.js"></script> 
<script src="http://maps.google.com/maps/api/js?key=AIzaSyBrGQ3WXjDyt6lu6OLS4RDNBXYb3Wr-l_Y"></script>
<script src='js/knockout-3.4.0.js'></script>
<script src="js/jquery.bxslider.min.js"></script> 
<script src="js/common.js"></script> 
<script>



var myloc = null;
var map;
var marker, i, chef;
var jsdNBC; // Json Obj Nearby chefs
var markersArray = [];
var distanceArray = [];

var myLatLng;
var infowindow;

var DineDiv, DeliveryDiv, chefDishImages;

function onDeviceReady() {
	useragent = navigator.userAgent;
	if ( useragent.indexOf('iPhone') !== -1 || useragent.indexOf('Android') !== -1 ) {
		navigator.geolocation.watchPosition( 
			showPosition, 
			onShortError, 
			{ enableHighAccuracy: true, maximumAge: 30000, timeout: 27000 }
		);			
		// or let other geolocation capable browsers to get their static position
	} else if ( navigator.geolocation ) {
		navigator.geolocation.getCurrentPosition( showPosition, onShortError );
	}
}

function initMap(){
	//console.log('initMap');
	myLatLng =  new google.maps.LatLng( localStorage.getItem('lat') , localStorage.getItem('lng') );
	var mapOptions = {
		center: myLatLng,
		mapTypeId: google.maps.MapTypeId.ROADMAP,
		zoom:9,
		scrollwheel: false,
		mapTypeControl: false
	};
					 
	map = new google.maps.Map(document.getElementById('map'), mapOptions);
   infowindow = new google.maps.InfoWindow({maxWidth: 400});

	/*
	DineDiv = document.createElement('div');
	DineDiv.className = 'TogActive';
	var dineControl = new DineControl(DineDiv, map);
	DineDiv.index = 2;
	map.controls[google.maps.ControlPosition.TOP_LEFT].push(DineDiv);
	
	DeliveryDiv = document.createElement('div');
	var deliveryControl = new DeliveryControl(DeliveryDiv, map);
	DeliveryDiv.index = 2;
	map.controls[google.maps.ControlPosition.TOP_LEFT].push(DeliveryDiv);
	*/
	
	var centerControlDiv = document.createElement('div');
	var centerControl = new CenterControl(centerControlDiv, map);
	centerControlDiv.index = 1;
	map.controls[google.maps.ControlPosition.TOP_RIGHT].push(centerControlDiv);

	

	var imageA = new google.maps.MarkerImage(
							'images/bluedot_retina.png',
							null, // size
							null, // origin
							new google.maps.Point( 9, 9 ), // anchor (move to center of marker)
							new google.maps.Size( 18, 18 ) // scaled size (required for Retina display icon)
						);
	
	myloc = new google.maps.Marker({
		flat: true,
		icon: imageA,
		map: map,
		optimized: false,
		position: myLatLng,
		title: 'I might be here',
		visible: true
	});
	loadMarkers();

} // end initMap

function onShortError(error){
	console.log(error);
}
function showPosition(pos){
	
	var me = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
	if(!empty(myloc)){
		myloc.setPosition(me);
	}
}


$(document).ready(function() {
    window.isphone = false;
    if(document.URL.indexOf("http://") === -1 && document.URL.indexOf("https://") === -1) {
        window.isphone = true;
    }

    if( window.isphone ) {
        document.addEventListener("deviceready", onDeviceReady, false);
    } else {
        onDeviceReady();
    }
});


var SliderStarted = false;

$(document).ready(function(e){
	
	$('#btnListView').on('click',function(){
		$('#MapView').hide();
		$('#ListView').show();
		$('#btnListView').hide();
		$('#btnMapView').show();

		if( SliderStarted == false ){
			//SliderStarted = true;
			
			$('#chef-listing-page .chef-listing').not('.hidden').remove();
			
			$DTemp = $('#chef-listing-page .chef-listing');
			
			for(var i=0; i<distanceArray.length; i++){
				var DI = distanceArray[i].DataKey;
				//console.log(jsdNBC[DI]);
				$copy = $DTemp.clone().removeClass('hidden');
				$copy.find('.chef-title').html(jsdNBC[DI].company);
				$copy.find('p.chef-city').html($.trim(jsdNBC[DI].city) +', '+jsdNBC[DI].state+ ' &nbsp;<span class="chef-distance">('+distanceArray[i].Dst.toFixed(1) +' miles away)</span>' );
				var Svcs = '';
				if( jsdNBC[DI].dine_dishes > 0 ) Svcs += 'Dine in, ';
				if( jsdNBC[DI].delivery_dishes > 0 ) Svcs += 'Delivery, ';
				if( jsdNBC[DI].ps_dishes > 0 ) Svcs += 'Personal Chef, ';
				
				if(!empty(Svcs)) Svcs = Svcs.substring(0, Svcs.length-2); // remove last comma
				$copy.find('p.chef-distance').html(Svcs);
				
				//$copy.find('p.chef-distance').html( distanceArray[i].Dst.toFixed(2) +' Miles Away' );
				if(!empty(jsdNBC[DI].image1)){
					$copy.find('ul.chef-carousel').append('<li><img height="200" src="http://mobileapi.foodiesys.com/foodie-mssql/pics/'+jsdNBC[DI].image1+'" alt=""/></li>');	
				}
				if(!empty(chefDishImages[jsdNBC[DI].id])){
					var imgs = chefDishImages[jsdNBC[DI].id];
					var Aimgs = imgs.split(',');
					console.log(Aimgs);
					for(var j=0;j<Aimgs.length;j++){
						if(!empty(Aimgs[j])){
							$copy.find('ul.chef-carousel').append('<li><img height="200" src="http://mobileapi.foodiesys.com/foodie-mssql/pics/'+Aimgs[j]+'" alt=""/></li>');	
						}
					}
				}
				if( jsdNBC[DI].mcolor == 'red' ){
					$copy.find('button').hide();
				}else{
					$copy.find('button').data('href', 'chef_profile.html?id='+jsdNBC[DI].id ); 
				}
				$('#chef-listing-page').append($copy);
				
				$('#bottom-bar .row2').hide();
				$('#bottom-bar .row1').show();
			}
			
			$('.chef-carousel').bxSlider({
				auto: true,
				autoHover: true,
				moveSlides: 1,
				controls: false,
				minSlides: 2,
				maxSlides: 8,
				slideWidth: 350,
				slideMargin: 5,
				infiniteLoop: true,
				hideControlOnEnd: true,
				pager: false
			});
		}
	});


	$('#btnMapView').on('click',function(){
		$('#ListView').hide();
		$('#MapView').show();
		$('#btnListView').show();
		$('#btnMapView').hide();
		$('#bottom-bar .row1').hide();
		$('#bottom-bar .row2').show();
		initMap();
	});
	
	$('#bottom-bar .row2 a').on('click',function(){
		$('#bottom-bar .row2 a').removeClass('active');
		$(this).addClass('active');
		showHideMarkers();	
	});
	
	if( empty(localStorage.getItem('userId'))){
		$('#footerLinksNormal').hide();
		$('#footerLinksNoLogin').show();
	}else{
		$('#footerLinksNoLogin').hide();
		$('#footerLinksNormal').show();
	}
	
	$(document).on('click','.btnMoreInfo',function(){
		//alert($(this).data('href'));
		document.location = $(this).data('href');
	});
	
	$('a.aResv').on('click',function(){
		localStorage.setItem('view_chef_id', $(this).prop('rel'));
		document.location = 'chef_profile.html';
	});
	
	var formData = 'lat='+localStorage.getItem("lat")+'&lng='+localStorage.getItem("lng")+'&user_id='+localStorage.getItem("userId")+'&app_token='+localStorage.getItem("userToken");
		
	$.ajax({
		type: "POST", dataType: 'json', url: ServerAjax+"?h=initApp", data: formData,
		//beforeSend: function() { waitingDialog.show(cLan.Loading, {dialogSize: 'sm', progressType: 'info'}); },
		//complete: function() { waitingDialog.hide(); },
	}).fail(  ajaxError )
	.done(function(data){
		if (data.Success == 'true') {
			
			//console.log(data.Chefs);
			localStorage.setItem('nearbyChefs', data.nearbyChefs );
			jsdNBC = JSON.parse( data.nearbyChefs );
			localStorage.setItem('nearbyChefsCount', data.nearbyChefsCount );
			localStorage.setItem('chefStatus', data.chefStatus );
			localStorage.setItem('chefData', data.chefData );
			localStorage.setItem('Notifications',data.Notifications );
			chefDishImages = data.chefDishImages;
			
			if(!empty(data.AvLang)){	localStorage.setItem('AvLang',data.AvLang ); }
			
			if(!empty(data.LanVersion) && data.LanVersion > cLan.Version ){
				
				$.get( ServerAjax+"?h=getLangJson&LG="+cLan.LangCode, function( data ) {
					try{
						var jt = JSON.parse(data);
						if(!empty(jt)){
							localStorage.setItem('LanguageData', data );		
						}
					}catch(e){}
				});
			}
			initData();
			console.log(distanceArray);
			$('#btnListView').trigger('click');
			showNotifications();
			
		}else{ 
			BAlert.find('.modal-header h3').html('<i class="fa fa-exclamation-triangle"></i> '+cLan.Error);
			BAlert.find('.modal-body').html('<p class="text-danger">'+data.Msg+'</p>');
			BAlert.modal();
		}
		if (data.JS) { eval(data.JS); }
		
	}); // ajax	
	
});
function showHideMarkers(){
	var fdine 		= $('#bottom-bar .row2 a.dine').hasClass('active');
	var fdelivery 	= $('#bottom-bar .row2 a.delivery').hasClass('active');
	var fps			= $('#bottom-bar .row2 a.ps').hasClass('active');
			 
	for (var i = 0; i < markersArray.length; i++ ) {
		var Vs = false;
		
		if( markersArray[i].mcolor == 'red' )
			Vs = true;
		else if( fdine == true && markersArray[i].dine_dishes > 0 )
			Vs = true; 
		else if( fdelivery == true &&  markersArray[i].delivery_dishes > 0 )	
			Vs = true;
		else if( fps == true &&  markersArray[i].ps_dishes > 0 )
			Vs = true;
		
		markersArray[i].setVisible(Vs);	
	}	
}	

function DineControl(controlDiv, map) { // Dine Btn on map 
	// Set CSS for the control border.
	var controlUI = document.createElement('div');
	controlUI.style.backgroundColor = '#efefef';
	controlUI.style.borderRadius = '2px';
	controlUI.style.boxShadow = '0 2px 2px rgba(0,0,0,.3)';
	controlUI.style.cursor = 'pointer';
	controlUI.style.marginTop = '6px';
	controlUI.style.marginLeft = '6px';

	controlUI.style.textAlign = 'center';
	controlUI.title = '';
	controlDiv.appendChild(controlUI);
	
	// Set CSS for the control interior.
	var controlText = document.createElement('div');
	/*controlText.style.color = '#FFFFFF';
	controlText.style.fontFamily = 'Roboto,Arial,sans-serif';*/
	controlText.style.fontSize = '18px';
	controlText.style.lineHeight = '30px';
	controlText.style.paddingLeft = '8px';
	controlText.style.paddingRight = '8px';
	controlText.innerHTML = 'Dine In';
	controlUI.appendChild(controlText);
	
	// Setup the click event listeners: simply set the map to Chicago.
	controlUI.addEventListener('click', function() {
		//map.panTo(myloc.getPosition());
		DeliveryDiv.className = '';
		DineDiv.className = 'TogActive';
		for (var i = 0; i < markersArray.length; i++ ) {
			if( markersArray[i].dine_dishes > 0 || markersArray[i].mcolor == 'red' ){
				markersArray[i].setVisible(true);
			}else{
				markersArray[i].setVisible(false);
			}
		}
		
	});
}
function DeliveryControl(controlDiv, map) { // Delivery Btn on map
	// Set CSS for the control border.
	var controlUI = document.createElement('div');
	controlUI.style.backgroundColor = '#efefef';
	controlUI.style.borderRadius = '2px';
	controlUI.style.boxShadow = '0 2px 2px rgba(0,0,0,.3)';
	controlUI.style.cursor = 'pointer';
	controlUI.style.marginTop = '6px';
	controlUI.style.marginLeft = '6px';

	controlUI.style.textAlign = 'center';
	controlUI.title = '';
	controlDiv.appendChild(controlUI);
	
	// Set CSS for the control interior.
	var controlText = document.createElement('div');
	controlText.style.fontSize = '18px';
	controlText.style.lineHeight = '30px';
	controlText.style.paddingLeft = '8px';
	controlText.style.paddingRight = '8px';
	controlText.innerHTML = 'Delivery';
	controlUI.appendChild(controlText);
	
	// Setup the click event listeners: simply set the map to Chicago.
	controlUI.addEventListener('click', function() {
		
		DeliveryDiv.className = 'TogActive';
		DineDiv.className = '';
		for (var i = 0; i < markersArray.length; i++ ) {
			if( markersArray[i].delivery_dishes > 0 || markersArray[i].mcolor == 'red' ){
				markersArray[i].setVisible(true);
			}else{
				markersArray[i].setVisible(false);
			}
		}
		
	});
}


function CenterControl(controlDiv, map) { // Center Map Btn on map
	// Set CSS for the control border.
	var controlUI = document.createElement('div');
	controlUI.style.cursor = 'pointer';
	controlUI.style.marginBottom = '12px';
	controlUI.style.marginTop = '12px';
	controlUI.style.marginRight = '10px';
	controlUI.style.textAlign = 'center';
	controlDiv.appendChild(controlUI);
	// Set CSS for the control interior.
	var controlText = document.createElement('IMG');
	controlText.style.width = '36px';
	controlText.style.height = '36px';
	controlText.style.cursor = 'pointer';
	controlText.width = '36';
	controlText.height = '36';
	controlText.src = 'images/center.png';
	controlUI.appendChild(controlText);
	// Setup the click event listeners: simply set the map to Chicago.
	controlUI.addEventListener('click', function() {
		map.panTo(myloc.getPosition());
	});
}


function initData(){
	distanceArray.length = 0;
	if(!empty(jsdNBC)){
		for (var i = 0; i < jsdNBC.length; i++) {
			chef = jsdNBC[i];
			if(empty(chef.dine_dishes)&&empty(chef.delivery_dishes)&&empty(chef.ps_dishes)){ // not dishes, mark him red
				jsdNBC[i].mcolor = 'red';
				chef.mcolor = 'red';
			}
			var Dst = distance(localStorage.getItem('lat'), localStorage.getItem('lng'), chef.lat, chef.lng, 'M');
			distanceArray.push({Dst:Dst, 'DataKey':i });
			distanceArray = distanceArray.sort(function (a, b) { return ( a.Dst - b.Dst ); });
		}
	}
}

function loadMarkers(){
	
	for (var i = 0; i < markersArray.length; i++ ) {
		markersArray[i].setMap(null);
	}
	
	markersArray.length = 0;
	
	if(!empty(jsdNBC)){
		for (var i = 0; i < jsdNBC.length; i++) {
			var chef = jsdNBC[i];
			marker = new google.maps.Marker({
				position: new google.maps.LatLng( chef.lat, chef.lng),
				map: map,
				dine_dishes: chef.dine_dishes ,
				delivery_dishes: chef.delivery_dishes,
				ps_dishes: chef.ps_dishes,
				mcolor: chef.mcolor
			});
			mColor = '|E44744|000000'; // red
			if( chef.mcolor == 'blue')  mColor = '|437CE5|000000'; // blue
			if( chef.mcolor == 'green')  mColor = '|5CB85C|000000'; // green
			
			marker.setIcon('http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld='+chef.company.charAt(0)+mColor );
			markersArray.push(marker);
			
			google.maps.event.addListener(marker, 'click', (function(marker, i) {
				return function() {
					infoWindowBs(i);	
				}
			})(marker, i));	
		}// endfor
	}	
}

function infoWindowBs(i){
	var r = 0;
	var r2 = '0.0'; 
	if( jsdNBC[i].rating_count > 0 ){
		r = jsdNBC[i].rating_sum /  jsdNBC[i].rating_count;
		r2 = r.toFixed(1); 
		r = (Math.round(r * 2) / 2).toFixed(1);
	}
	ri = '<img src="images/'+r+'.gif" alt="" />' ;
	
	var img = 'images/no-pic3.jpg';
	if(!empty(jsdNBC[i].image1)){
		img = 'http://mobileapi.foodiesys.com/foodie-mssql/pics/'+jsdNBC[i].image1;
	}
	
	var Hh			= '<h1>'+jsdNBC[i].company+'</h1>';
	

	Hh += '<div class="foodcost">'+cLan.FoodCost+': '+jsdNBC[i].food_cost+'<div style="display:inline-block;" class="pull-right">'+ri+'</div></div>';
	Hh += '<div style="margin-top:10px;" class="address"><table class="table addressTable"><tr><td width="10%"><strong>'+cLan.Address+':&nbsp;&nbsp;</strong></td><td>'+ucwords(jsdNBC[i].address)+'<br/>'+ucwords(jsdNBC[i].city)+', '+jsdNBC[i].state+'</td></tr></table></div>';
	
	if( jsdNBC[i].mcolor != 'red' ){
		Hh += '<button class="btn btnMoreInfo btn-primary btn-sm pull-right"  data-href="chef_profile.html?id='+jsdNBC[i].id+'">More Info</button> <div class="clearfix"></div>';
	}
	
	$('#infoWin .side-contents').html(Hh);
	$('#infoWin .model-image').html('<img src="'+img+'" alt="capture" style="width:100%" class="img-responsive">');
	
	$('#infoWin').modal();
}

/*
useragent = navigator.userAgent;
if ( useragent.indexOf('iPhone') !== -1 || useragent.indexOf('Android') !== -1 ) {
	navigator.geolocation.watchPosition( 
		showPosition, 
		onShortError, 
		{ 
			enableHighAccuracy: true, 
			maximumAge: 30000, 
			timeout: 27000 
		}
	);			
	// or let other geolocation capable browsers to get their static position
} else if ( navigator.geolocation ) {
	navigator.geolocation.getCurrentPosition( showPosition, onShortError );
}
*/


	 
/**/
</script>
</body>
</html>