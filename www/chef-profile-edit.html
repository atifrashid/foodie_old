<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Fudi</title>

<!-- Sets initial viewport load and disables zooming  -->
<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, width=device-width" />



<!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="mobile-web-app-capable" content="yes">
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/font-awesome.min.css" rel="stylesheet">
<link href="css/styles.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="css/jquery-gmaps-latlon-picker.css"/>
<style>

</style>
</head>
<body id="wrapper">
<div id="sidebar-wrapper">
	<nav id="nav">
		<ul class="sidebar-nav nav" id="navRight">
			<li class="L0 menu-heading"><i class="icon-user"></i><strong><a href="#" data-bind="text: lang.Foodie"></a></strong></li>
			<li class="L2"><i class="icon-pointer-advice"></i><a class="sub" href="map.html" data-bind="text: lang.mnuChefs"></a><li></li>
			<li class="L2"><i class="icon-user"></i><a class="sub" href="user-profile.html" data-bind="text: lang.MyProfile"></a></li>
			<li class="L2"><i class="icon-credit-cards"></i><a class="sub" href="payment-options.html" data-bind="text: lang.PO"></a></li>
			<li class="L2"><i class="icon-tray"></i><a class="sub" href="reservations.html" data-bind="text: lang.MyOrders"></a></li>
			<li class="L2"><i class="icon-mail"></i><a class="sub" href="notifications.html" data-bind="text: lang.Notifications"></a></li>
			<li class="L0 menu-heading"><i class="icon-chef"></i><strong><a data-bind="text: lang.CHEF" href="#"></a></strong></li>
			<li class="L2 noChef"><i class="icon-chef"></i><a class="sub" data-bind="text: lang.BecomeaChef" href="chef-profile-edit.html"></a></li>
			<li class="L2 isChef pChef"><i class="icon-chef"></i><a class="sub" data-bind="text: lang.ChefProfile" href="chef-profile-edit.html"></a></li>
			<li class="L2 isChef"><i class="icon-food"></i><a class="sub" data-bind="text: lang.ManageDishes" href="chef-dishes.html"></a></li>
			<li class="L2 isChef"><i class="icon-clock"></i><a class="sub" data-bind="text: lang.Schedule" href="chef-calendar-set.html"></a></li>
			<li class="L2 isChef"><i class="icon-calendar"></i><a class="sub" data-bind="text: lang.DeliverySchedule" href="delivery-schedule.html"></a></li>
			<li class="L2 isChef"><i class="icon-calendar-1"></i><a class="sub" data-bind="text: lang.PSmenu" href="ps-schedule.html"></a></li>
			<li class="L2 isChef"><i class="icon-reserve"></i><a class="sub" data-bind="text: lang.ChefReservations" href="chef-reservations.html"></a></li>
			<li class="L2 isChef"><i class="icon-withdraw"></i><a class="sub" data-bind="text: lang.WithdMon" href="withdraw-money-chef.html"></a></li>
			<li class="L1"><i class="icon-gear"></i><a href="settings.html" data-bind="text: lang.Settings"></a></li>
			<li class="L1"><i class="icon-about"></i><a href="about.html" data-bind="text: lang.AboutFudi"></a></li>
			<li class="L1"><i class="icon-logout"></i><a href="register.html?do=logout" data-bind="text: lang.Logout"></a></li>
		</ul>
	</nav>
</div>
<div id="user-profile-page" class="content">
	<h1 id="menu-button"> <a id="menu-toggle" href="#" class="btn-menu toggle"> <i class="fa fa-bars"></i> </a>
		<p class="pageTitle" data-bind="text: lang.Edcp">Edit Chef Profile</p>
	</h1>
	<div id="topAlert" style="display:none" class="alert alert-warning"><i class="fa fa-warning"></i> <span data-bind="text: lang.Pfysp">Please fill your chef profile below to register as a chef; however your profile will be active once approved by our staff.</span></div>
	
	
	<div id="aLoading" class="aLoading text-center" style="display:none"><img src="images/loading.gif" sytle=" margin: 0 auto;" /></div>
	
	<form id="user-form" style="display:none">
		<!--<div class="form-group">
			<div id="image-upload" class="text-center" onClick="uploadImage()"> <img id="pimage" src="images/no-pic.jpg" height="100" /> </div>
			<div id="picture_msg" class="text-center help-block"> <span data-bind="text: lang.Toponpic">Tap on picture to change/upload</span> </div>
		</div>-->
		<div class="form-group">
			<div id="image-upload" class="text-center"> <img id="pimage" src="images/no-pic.jpg" height="100" /> </div>
			<div class="text-center" style="margin-top:5px;">
				<button id="btnImagesPop" type="button" class="btn btn-sm btn-primary" data-bind="text: lang.EditPic">Add/Edit Pictures</button>
			</div>
		</div>
		
		<div class="form-group">
			<label data-bind="text: lang.CompanyName">Company Name</label>
			<input class="form-control required" type="text" name="company" value=""  placeholder="Company Name" maxlength="60">
		</div>
		
		<div class="form-group">
			<label data-bind="text: lang.About">About</label>
			<textarea class="form-control" name="about" rows="4"></textarea>
		</div>
		
		<div class="form-group col-xs-6">
			<label data-bind="text: lang.FirstName">First Name</label>
			<input class="form-control" type="text" name="first_name" value=""  placeholder="First Name" maxlength="16">
		</div>
		<div class="form-group col-xs-6 last">
			<label data-bind="text: lang.LastName">Last Name</label>
			<input class="form-control" type="text" name="last_name" value="" placeholder="Last Name" maxlength="16">
		</div>
		<div class="form-group">
			<label data-bind="text: lang.PaypalEmail">Paypal Email</label>
			<input class="form-control required email" type="email" name="email" value="">
			<p class="help-block" data-bind="text: lang.PaypalHlp"></p>
		</div>
		<div class="form-group">
			<label data-bind="text: lang.Phone">Phone</label>
			<input class="form-control required" type="phone" name="phone" value="" >
		</div>
		<div class="form-group">
			<label data-bind="text: lang.Address">Address</label>
			<input class="form-control required" type="text" name="address" value="" maxlength="100">
		</div>
		<div class="form-group">
			<label data-bind="text: lang.City">City</label>
			<input class="form-control required" type="text" name="city" value="" maxlength="16">
		</div>
		<div class="form-group col-xs-6">
			<label data-bind="text: lang.State">State</label>
			<select class="form-control required" name="state" id="state">
				<option value="">-- Select State --</option>
				<option value="AL">Alabama</option>
				<option value="AK">Alaska</option>
				<option value="AZ">Arizona</option>
				<option value="AR">Arkansas</option>
				<option value="CA">California</option>
				<option value="CO">Colorado</option>
				<option value="CT">Connecticut</option>
				<option value="DE">Delaware</option>
				<option value="DC">Dist. of Columbia</option>
				<option value="FL">Florida</option>
				<option value="GA">Georgia</option>
				<option value="HI">Hawaii</option>
				<option value="ID">Idaho</option>
				<option value="IL">Illinois</option>
				<option value="IN">Indiana</option>
				<option value="IA">Iowa</option>
				<option value="KS">Kansas</option>
				<option value="KY">Kentucky</option>
				<option value="LA">Louisiana</option>
				<option value="ME">Maine</option>
				<option value="MD">Maryland</option>
				<option value="MA">Massachusetts</option>
				<option value="MI">Michigan</option>
				<option value="MN">Minnesota</option>
				<option value="MS">Mississippi</option>
				<option value="MO">Missouri</option>
				<option value="MT">Montana</option>
				<option value="NE">Nebraska</option>
				<option value="NV">Nevada</option>
				<option value="NH">New Hampshire</option>
				<option value="NJ">New Jersey</option>
				<option value="NM">New Mexico</option>
				<option value="NY">New York</option>
				<option value="NC">North Carolina</option>
				<option value="ND">North Dakota</option>
				<option value="OH">Ohio</option>
				<option value="OK">Oklahoma</option>
				<option value="OR">Oregon</option>
				<option value="PA">Pennsylvania</option>
				<option value="RI">Rhode Island</option>
				<option value="SC">South Carolina</option>
				<option value="SD">South Dakota</option>
				<option value="TN">Tennessee</option>
				<option value="TX">Texas</option>
				<option value="UT">Utah</option>
				<option value="VT">Vermont</option>
				<option value="VA">Virginia</option>
				<option value="WA">Washington</option>
				<option value="WV">West Virginia</option>
				<option value="WI">Wisconsin</option>
				<option value="WY">Wyoming</option>
			</select>
		</div>
		<div class="form-group col-xs-6 last">
			<label data-bind="text: lang.Zip">Zip</label>
			<input class="form-control required" type="number" name="zip" value="" id="zip" maxlength="6" >
		</div>
		
		<div class="form-group">
			<label data-bind="text: lang.SeatingCapacity">Seating Capacity</label>
			<input class="form-control required" type="number" name="capacity" value="" id="capacity">
		</div>
		
		
		<div class="form-group">
			<label data-bind="text: lang.REo">Referral Email (Optional)</label>
			<input id="txtReferalEmail" class="form-control email" type="email" name="referral_email" value="" >
		</div>
		

		
		<button type="submit" id="btnSubmit" class="btn btn-primary btn-block btn-submit" data-bind="text: lang.Submit">Submit</button>
	</form>
</div>


<div class="modal fade" id="popImages" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" data-bind="text: lang.Pics">Pictures</h4>
			</div>
			<div class="modal-body">
				
				<button id="btnAddPic" class="btn btn-success btn-block btn-sm" data-bind="text: lang.AddPic">Add Picture</button>
				<br />
				<div id="spPics">
				<div class="row">
					
				</div>
				</div>
				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" data-dismiss="modal" data-bind="text: lang.OK"></button>
			</div>
		</div>
	</div>
</div>

<script src="cordova.js"></script> 
<script src="js/jquery-1.11.3.min.js"></script> 
<script src="js/jquery.validate.min.js"></script> 
<script src="js/bootstrap.min.js"></script> 
<script src='js/knockout-3.4.0.js'></script> 
<script src="js/common.js"></script> 


<script>

var chefData;

$(document).ready(function(e) {
	
	setSubmitButton();
	
	var formData = 'lat='+localStorage.getItem("lat")+'&lng='+localStorage.getItem("lng")+'&userId='+localStorage.getItem('userId')+'&userToken='+localStorage.getItem('userToken'); 
	$.ajax({
		type: "POST", dataType: 'json', url: ServerAjax+"?h=getChefProfile", data: formData,
		beforeSend: function() { $('#aLoading').show();  },
		complete: function() { $('#aLoading').hide(); },
	}).fail(  ajaxError )
	.done(function(data){
		if (data.Success == 'true') {
			localStorage.setItem('chefData', data.chefData );
			localStorage.setItem('chefStatus', data.chefStatus );
			chefData = JSON.parse(data.chefData);
			prepareForm();
			$("#user-form").show();
			setSubmitButton();
			initMenu();
		} else { 
			BAlert.find('.modal-header h3').html('<i class="fa fa-exclamation-triangle"></i> '+cLan.Error);
			BAlert.find('.modal-body').html('<p class="text-danger">'+data.Msg+'</p>');
			BAlert.modal();
		}
		if (data.JS) { eval(data.JS); }
	
	}); // ajax	

	
	$('#btnImagesPop').on('click',function(){
		
		populateImagePopup();
		$('#popImages').modal();
	});
	
	//$('#popLoc').modal();

	
	//$(document).gMapsLatLonPicker().init( $('#gllpLatlonPicker') );
	
	$("#user-form").validate({
		errorPlacement: function(error, element) {},
		submitHandler: function(form) {
			
			console.log( $('#pimage').prop('src') );
			if( $('#pimage').prop('src').indexOf('no-pic.jpg') != -1 ){
				
				BAlert.find('.modal-header h3').html('<i class="fa fa-exclamation-triangle"></i> '+cLan.Error);
				BAlert.find('.modal-body').html('<p class="text-danger">'+cLan.s124+'</p>');
				BAlert.modal();
				return false;
			}
			
			formData = $(form).serialize();
			formData += '&userId='+localStorage.getItem('userId')+'&userToken='+localStorage.getItem('userToken'); 
			$.ajax({
				type: "POST", dataType: 'json', url: ServerAjax+"?h=chefUpdate", data: formData,
				beforeSend: function() { waitingDialog.show(cLan.Loading, {dialogSize: 'sm', progressType: 'info'}); },
				complete: function() { waitingDialog.hide(); },
			}).fail(  ajaxError )
			.done(function(data){
				if (data.Success == 'true') {
					localStorage.setItem('chefData', data.chefData );
					localStorage.setItem('chefStatus', data.chefStatus );
					chefData = JSON.parse(data.chefData);
					BAlert.find('.modal-header h3').html('<i class="fa check"></i>'+cLan.Success);
					BAlert.find('.modal-body').html('<p class="text-success">'+cLan.ProfileUpdated+'.</p>');
					BAlert.modal();
					setSubmitButton();
				} else { 
					ErrorModalWithParm(data);
				}
				if (data.JS) { eval(data.JS); }
			
			}); // ajax	

		}// submit handler
	});	
	
});

function populateImagePopup(){
	$('#spPics div.row').html('');
	var images = [];
	var H = '';
	
	
	if( !empty(chefData) && !empty(chefData.image1)){
		H = '<div class="col-xs-6 "><div class="thumbnail"><a href="#" class="imgRemove badge pull-right"><i class="fa fa-remove"></i></a><img data-name="'+chefData.image1+'" data-del="" data-main="1" src="http://mobileapi.foodiesys.com/foodie-mssql/pics/'+chefData.image1+'" alt=""><div class="caption"><a href="#" class="toggleDef"><i class="fa fa-toggle-on green"></i></a> <p>Main Photo</p></div></div></div>'; 
	}
	if( !empty(chefData) && !empty(chefData.image2)){
		imt = chefData.image2.split(',');
		for(i=0; i<imt.length; i++){
			if(empty(imt[i])) continue;
			H += '<div class="col-xs-6 "><div class="thumbnail"><a href="#" class="imgRemove badge pull-right"><i class="fa fa-remove"></i></a><img data-name="'+imt[i]+'" data-del="" data-main="" src="http://mobileapi.foodiesys.com/foodie-mssql/pics/'+imt[i]+'" alt=""><div class="caption"><a href="#" class="toggleDef"><i class="fa fa-toggle-off green"></i></a> <p>Main Photo</p></div></div></div>'; 
		}
	}
	$('#spPics div.row').append(H);	
}

function prepareForm(){
	if( !empty(localStorage.getItem('chefStatus')) && !empty( chefData )){
		$('#user-form').find(':input').each(function(){
			el = $(this);
			if( el.prop('type') == 'radio' || el.prop('type') == 'checkbox'  ){
				if( el.val() == chefData[el.prop('name')] ){ el.prop('checked', true); el.trigger('change'); }
			}else{
				if( !empty(chefData[el.prop('name')])  ){
					el.val( chefData[el.prop('name')] );
				}
			}
		});
		
		if(!empty(chefData.image1)){
			$('#pimage').prop('src','http://mobileapi.foodiesys.com/foodie-mssql/pics/' + chefData.image1);	
		}else{
			$('#pimage').prop('src','images/no-pic.jpg');	
		}
	}else{ // Become A Chef
		$('#pickLat').val(localStorage.getItem('lat'));
		$('#pickLng').val(localStorage.getItem('lng'));	
		$('#topAlert').show();
	}	
}

$('#btnAddPic').on('click',function(e){
	uploadImage2();
});


$('#spPics').on('click', '.imgRemove', function(e){ // delete picture
	var DLGConfirm = $('<div class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" style="padding-top:15%; overflow-y:visible;">' +
	'<div class="modal-dialog modal-md"><div class="modal-content">' +
		'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>' +
		'<h3 style="margin:0;">'+cLan.Delete+'</h3></div><div class="modal-body"><p>'+cLan.ConfirmMsgPic+'</p></div>' +
		'<div class="modal-footer"><button type="button" class="btn confirm btn-danger" data-dismiss="modal">'+cLan.Delete+'</button><button type="button" class="btn" data-dismiss="modal">'+cLan.Cancel+'</button></div>'+
	'</div></div></div>');
	DLGConfirm.find('.confirm').on('click',{ me:this },function(e){
		$(e.data.me).closest('.thumbnail').find('img').data('del','1');
		updatePicsDB();
		// $(e.data.me).closest('div.col-xs-6').remove();
	});
	DLGConfirm.modal();
	e.preventDefault();
});

$('#spPics').on('click', '.toggleDef', function(e){ // make main pic
	if($(this).find('i').hasClass('fa-toggle-off')){
		$('#spPics i').removeClass('fa-toggle-on');
		$(this).find('i').addClass('fa-toggle-on');
		$('#spPics .thumbnail').find('img').data('main','0');
		$(this).closest('.thumbnail').find('img').data('main','1');
		updatePicsDB();
	} 
});



function updatePicsDB(){
	var jData = {'userId' : localStorage.getItem('userId'), 'userToken': localStorage.getItem('userToken'), jsonData :{} };
	var xObj = [] ;
	$('#spPics .thumbnail img').each(function(index, element) {
		xObj.push({'name':$(this).data('name'), 'del':$(this).data('del'), 'main':$(this).data('main') });
	});
	jData.jsonData = xObj;
	// console.log(jData); return;
	$.ajax({
		type: "POST", dataType: 'json', url: ServerAjax+"?h=manageChefPics", data: jData,
		beforeSend: function() { waitingDialog.show(cLan.Loading, {dialogSize: 'sm', progressType: 'info'}); },
		complete: function() { waitingDialog.hide(); },
	}).fail(  ajaxError )
	.done(function(data){
		if (data.Success == 'true') {
			var rs = JSON.parse(data.chefImgData);
			chefData.image1 = rs.image1;
			chefData.image2 = rs.image2;
			populateImagePopup();

			if(!empty(chefData.image1)){
				$('#pimage').prop('src','http://mobileapi.foodiesys.com/foodie-mssql/pics/' + chefData.image1);	
			}else{
				$('#pimage').prop('src','images/no-pic.jpg');	
			}
			
		} else { 
			ErrorModalWithParm(data);
		}
		if (data.JS) { eval(data.JS); }
	
	}); // ajax	
	
}

function uploadImage2() {
	
	//var H = '<div class="col-xs-6 "><div class="thumbnail"><a href="#" class="imgRemove badge pull-right"><i class="fa fa-remove"></i></a><img data-name="57274b62d0e85.jpg" data-del="" data-main="" src="http://mobileapi.foodiesys.com/foodie-mssql/pics/57274b62d0e85.jpg" alt=""><div class="caption"><a href="#" class="toggleDef"><i class="fa fa-toggle-off green"></i></a> Main Photo</div></div></div>'; 
	//$('#spPics div.row').append(H);
	//return; 

	navigator.camera.getPicture(
	function(uri) {
		try {
			//spPics
			var imageURI = uri;
			if (!imageURI) {
				return;
			}else{
				waitingDialog.show(cLan.Loading, {dialogSize: 'sm', progressType: 'info'});
			}
			// Verify server has been entered
			//server = 'http://mobileapi.foodiesys.com/foodie-mssql/upload.php';
			server = 'http://mobileapi.foodiesys.com/foodie-mssql/upload.php'; //?chid='+localStorage.getItem('userId');
			
			var options = new FileUploadOptions();
			options.fileKey = "file";
			options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
			options.mimeType = "image/jpeg";
			options.chunkedMode = false;

			// Transfer picture to server
			var ft = new FileTransfer();
			ft.upload(imageURI, server, function(r){
				waitingDialog.hide();
				if (r.response.match("^Error")){
					//$('#picture_msg').html(r.response);
				}else{ // Success
					//$('#hd_image1').val(r.response);
					var H = '<div class="col-xs-6 "><div class="thumbnail"><a href="#" class="imgRemove badge pull-right"><i class="fa fa-remove"></i></a><img data-name="'+r.response+'" data-del="" data-main="" src="http://mobileapi.foodiesys.com/foodie-mssql/pics/'+r.response+'" alt=""><div class="caption"><a href="#" class="toggleDef"><i class="fa fa-toggle-off green"></i></a> Main Photo</div></div></div>'; 
					$('#spPics div.row').append(H);
					
					setTimeout( function() {
						updatePicsDB();
					}, 600);
					
				}
			},

			function(error) {
				BAlert.find('.modal-header h3').html('<i class="fa fa-exclamation-triangle"></i> '+cLan.Error);
				BAlert.find('.modal-body').html('<p class="text-danger">'+cLan.Uploadfailed+" : Code = " + error.code+'</p>');
				BAlert.modal();
			}, options);

		} catch (exce) {
			alert(exce);
		}
	},

	function(e) {
		console.log("Error getting picture: " + e);
		$('#picture_msg').html(cLan.NoPic);
	}, {
		quality: 65,
		allowEdit : true,
		destinationType: navigator.camera.DestinationType.FILE_URI,
		sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY,
		targetWidth: 600,
  		targetHeight: 600
	});
}




function setSubmitButton(){
	$('#btnSubmit').removeClass('disabled');
	if(localStorage.getItem('chefStatus')== '1' ){ // pending approval
		$('#btnSubmit').html(cLan.PendingApproval).addClass('disabled');
		$('#txtReferalEmail').prop('disabled', true)
	}else if(localStorage.getItem('chefStatus')== '2' ){ // approved/active
		$('#btnSubmit').html(cLan.UPDATE);
		$('#txtReferalEmail').prop('disabled', true);
	}
}


</script>
</body>
</html>